<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>NYCSplat</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Luma Splats Shader Demo</title>
  <style>
    html,body { margin:0; height:100%; background:#000; }
    canvas { display:block; width:100vw; height:100vh; }
  </style>
</head>
<body>
  
  	<script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three@0.157.0/build/three.module.js",
			"three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/",
			"@lumaai/luma-web": "https://unpkg.com/@lumaai/luma-web@0.2.0/dist/library/luma-web.module.js"
		}
	}
	</script>
  <canvas></canvas>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.157.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.157.0/examples/jsm/controls/OrbitControls.js";
    import { LumaSplatsThree } from "https://unpkg.com/@lumaai/luma-web@0.2.0/dist/library/luma-web.module.js";
    import GUI from "https://cdn.jsdelivr.net/npm/lil-gui@0.19/+esm";

    // --- renderer + scene ---
    const canvas = document.querySelector("canvas");
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight, false);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xdddddd);
    scene.fog = new THREE.FogExp2(0xdddddd, 0.05);

    const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.01, 1000);
    camera.position.set(0, 0, 2);
    const controls = new OrbitControls(camera, canvas);
    controls.enableDamping = true;

    // --- Luma splat ---
    const splat = new LumaSplatsThree({
      // use your own public capture URL or a .splat file URL
      source: "https://lumalabs.ai/capture/eb18441d-7d28-46db-b45c-7b484078b6db"
    });
    scene.add(splat);

    // --- shader uniforms ---
    const uniforms = {
        time_s:    { value: 0.0 },
        amplitude: { value: 0.25 },   // start bigger so it's visible
        frequency: { value: 2.0 }
    };

    // wait until loaded to set shader hooks
    splat.addEventListener("loaded", () => {
    //   splat.setShaderHooks({
    //     vertexShaderHooks: {
    //       additionalUniforms: {
    //         time_s:    ["float", uniforms.time_s],
    //         amplitude: ["float", uniforms.amplitude],
    //         frequency: ["float", uniforms.frequency]
    //       },
    //       getSplatTransform: /* glsl */`
    //         (vec3 position, uint layersBitmask) {
    //           float y = sin(position.x * frequency + time_s) * amplitude;
    //           return mat4(
    //             1.,0.,0.,0.,
    //             0.,1.,0.,0.,
    //             0.,0.,1.,0.,
    //             0.,y,0.,1.
    //           );
    //         }
    //       `
    //     }
    //   });
    });



    // --- GUI controls ---
    const gui = new GUI({ title: "Shader Controls" });
    // gui.add(uniforms.amplitude, "value", 0.0, 5.0, 0.01).name("Wave Amplitude");
    // gui.add(uniforms.frequency, "value", 0.1, 35.0, 0.1).name("Wave Frequency");
    gui.add(scene.fog, "density", 0.0, 2.0, 0.005).name("Fog Density");
    gui.addColor(scene.fog, "color").name("Fog Color");
    const scale = { value: 1 };
    gui.add(scale, 'value', 0.1, 3, 0.1).name('Splat Scale')
    .onChange(v => splat.scale.set(v, v, v));


    // --- loop ---
    renderer.setAnimationLoop(() => {
    //   uniforms.time_s.value = performance.now() * 0.001;
      controls.update();
      renderer.render(scene, camera);
    });

    // --- resize ---
    addEventListener("resize", () => {
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight, false);
    });
  </script>
</body>
</html>
    
  </body>
  
</html>
